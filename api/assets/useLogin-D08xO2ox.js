import{k as G,l as M,r as k,c as N,m as T,b as I,n as U,g as x,h as C,o as L,p as W,q as P}from"./index-Dye69HlV.js";function t(c){const b=`; ${document.cookie}`.split(`; ${c}=`);if(b.length===2)return b.pop().split(";").shift()}const j=()=>{const{search:c}=G();return M.useMemo(()=>new URLSearchParams(c),[c])},$=()=>{const[c,D]=k.useState(!1),[b,m]=k.useState(null),[v,r]=k.useState(!1),{dispatch:y}=N(),e=j(),A=async f=>{const s=x(C,"users",f);return(await P(s)).exists()},E=async f=>{m(null),r(!0);try{const s=await T(I,U);if(f==="login")y({type:"LOGIN",payload:s.user});else{let n=0;const g=10;for(;n<g;){if(await A(s.user.uid)){const u=x(C,"users",s.user.uid),i={online:!0,user_agent:navigator.userAgent,origin:window.location.href.split("?")[0]},l=t("_fbp"),p=t("_fbc");l&&(i.fbp=l),p&&(i.fbc=p);const d=e.get("utm_source")||t("utm_source"),_=e.get("utm_medium")||t("utm_medium"),h=e.get("utm_campaign")||t("utm_campaign"),w=e.get("utm_term")||t("utm_term"),o=e.get("utm_content")||t("utm_content"),a={};d&&(a.source=d),_&&(a.medium=_),h&&(a.campaign=h),w&&(a.term=w),o&&(a.content=o),Object.keys(a).length>0&&(i.utm=a);const S=e.get("sck")||t("sck");S&&(i.sck=S),await L(u,i),y({type:"LOGIN",payload:s.user});break}n++,await new Promise(u=>setTimeout(u,1e3))}if(n===g)throw new Error("Max attempts reached. User doc was not created.")}c||(r(!1),m(null))}catch(s){console.log(s.message),c||(m(s.message),r(!1))}},O=async(f,s)=>{m(null),r(!0);try{const n=await W(I,f,s),g=x(C,"users",n.user.uid);if((await P(g)).exists()){const u={online:!0,lastLogin:new Date,user_agent:navigator.userAgent,origin:window.location.href.split("?")[0]},i=t("_fbp"),l=t("_fbc");i&&(u.fbp=i),l&&(u.fbc=l);const p=e.get("utm_source")||t("utm_source"),d=e.get("utm_medium")||t("utm_medium"),_=e.get("utm_campaign")||t("utm_campaign"),h=e.get("utm_term")||t("utm_term"),w=e.get("utm_content")||t("utm_content"),o={};p&&(o.source=p),d&&(o.medium=d),_&&(o.campaign=_),h&&(o.term=h),w&&(o.content=w),Object.keys(o).length>0&&(u.utm=o);const a=e.get("sck")||t("sck");a&&(u.sck=a),await L(g,u)}y({type:"LOGIN",payload:n.user}),c||(r(!1),m(null))}catch(n){c||(console.log(n.message),m(n.message),r(!1))}};return k.useEffect(()=>()=>{r(!1),D(!0)},[]),{login:O,authenticateWithGoogle:E,error:b,isPending:v}};export{j as a,t as g,$ as u};
